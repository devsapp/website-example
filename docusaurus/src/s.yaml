edition: 3.0.0
name: start-docusaurus
access: "{{ access }}"
vars:
  region: "{{ region }}"
resources:
  start_docusaurus:
    component: fc3
    actions:
      pre-deploy:
        - run: export PATH=/usr/local/versions/node/v20.8.1/bin:$PATH && npm install
          path: ./code
        - run: export PATH=/usr/local/versions/node/v20.8.1/bin:$PATH && npm run build
          path: ./code
        - run: cp nginx.conf ./build/nginx.conf
          path: ./code
    props:
      region: ${vars.region}
      functionName: "{{ functionName }}"
      description: Docusaurus Example
      timeout: 60
      cpu: 1
      memorySize: 2048
      diskSize: 512
      instanceConcurrency: 100
      customRuntimeConfig:
        command:
          - "/opt/bin/nginx"
          - "-c"
          - "/code/nginx.conf"
          - "-g"
          - "daemon off;"
        port: 9000
      code: ./code/build
      runtime: custom.debian10
      layers:
        - acs:fc:${vars.region}:official:layers/Nginx/versions/1
      customDomain:
        domainName: auto
        protocol: HTTP
        route:
          path: /*
          qualifier: LATEST
